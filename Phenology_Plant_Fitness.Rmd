---
title: "Phenology and Plant Fitness"
author: "Annie Schiffer"
date: "started 27 January 2020; most recent edits `r format(Sys.time(), '%d %B %Y')`"
output: 
  html_document:
    toc: true
    toc_depth: 4
    toc_float: true
    number_sections: true
    code_folding: hide
    theme: cosmo
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Overview

This project aims to connect floral phenology to reproductive success on the individual level and landscape level for three subalpine plants. Data were collected at the Rocky Mountain Biological Laboratory during the 2019 field season. Focal species include Mertensia fusiformis, Potentilla pulcherrima, and Delphinium nuttalianum. 

Our questions specifically ask: 
  1. how does blooming time affect seed set for individiuals in a population?
  2. how does blooming time of populations affect seed set compared to other populations in a landscape?
  3. how does accelerated snowmelt affect phenology and seed set on the individual and population level?
  
Individuals of the three species were tagged in control and manipulated plots in eight sites across East River valley and Washington Gulch. Seed set was quantified as the count of total developed seeds in each individual. 

Because there were sources of non-independence in this study, our statistical approach involves generalized linear mixed effects models. Before we ran these models, we converted phenological data to a "relative position" value that represents how many days before or after the community peak the individual was in bloom....

# Load Packages

```{r clearing environment}
rm(list = ls())
```

```{r packages}
suppressWarnings(suppressPackageStartupMessages(require(knitr)))
suppressWarnings(suppressPackageStartupMessages(require(tidyverse)))
suppressWarnings(suppressPackageStartupMessages(require(lme4)))
suppressWarnings(suppressPackageStartupMessages(require(ggplot2)))
suppressWarnings(suppressPackageStartupMessages(require(RColorBrewer)))
suppressWarnings(suppressPackageStartupMessages(require(fitdistrplus)))
suppressWarnings(suppressPackageStartupMessages(require(glmmADMB)))
suppressWarnings(suppressPackageStartupMessages(require(MuMIn)))
suppressWarnings(suppressPackageStartupMessages(require(lubridate)))
```

# Data Import & Basic Formatting

The imported csv files contain the following for each individual of a species: bloom start and end estimates, relative position of blooming in the community, soil moisture variables, and seed counts. These elements were compiled from five different data sets and calculated in a separate document. To view the data cleaning process, refer to the data cleaning R Markdown file, Data_Cleaning.Rmd. 

## Mertensia Data

The first dataset contains the individual data for Mertensia fusiformis, which was found in four of our sites. For Mertensia, we calculated the proportion of developed seeds in addition to the seed counts. We also reformatted the relative position as a deviation variable (the absolute value of the relative position) and a early/late variable (the direction of the relative position).

```{r Mertensia data import}
mert = read.csv("Mertensia_final2.csv") # read in Mertensia data
mert<-mert[!is.na(mert$total.seeds),] #removing NA values from Mertenia total seed column
mert<-mert[!is.na(mert$relative.position),] #removing NA values from relative position column
mert$prop.dev.seeds<-(mert$dev.seed/mert$total.seeds) #adding proportion of developed seeds
mert$deviation<-abs(mert$relative.position) #getting deviation from the peak
mert$early.late<-factor(NA, levels = c("early","late")) #creating early/late variables based on relative position
mert$early.late[mert$relative.position<0]<-"early"
mert$early.late[mert$relative.position>0]<-"late"
mert<-mert[!is.na(mert$early.late),] #is this right???
```

## Delphinium Data

The second dataset contains individual data for Delphinium nuttalianum. Delphinium was found in four of our sites. For Delphinium, we calculated proportion, deviation, and early/late value like we did with the Mertensia data. 

```{r Delphinium data import}
delph = read.csv("Delphinium_final2.csv") # read in Delphinium data
delph<-delph[!is.na(delph$total.seeds),] #removing NA values in seed column
delph<-delph[!is.na(delph$relative.position),] #removing NA values in the relative position
delph$prop.dev.seeds<-(delph$total.seeds/(delph$undev.seed1+delph$undev.seed+delph$total.seeds)) #adding proportion of developed seeds
delph$deviation<-abs(delph$relative.position) #getting deviation from the peak
delph$early.late<-factor(NA, levels = c("early","late")) #creating early/late variables based on relative position
delph$early.late[delph$relative.position<0]<-"early"
delph$early.late[delph$relative.position>0]<-"late"
delph<-delph[!is.na(delph$early.late),] #still not sure this is right
```

## Potentilla Data

The third dataset contains Potentilla pulcherrima data. Potentilla was set up in all but one of our sites. Potentilla data only includes total seed counts because we couldn't count the undeveloped seeds. However, we calculated the deviation and early/late values like the previous species.

```{r Potentilla data import}
pot = read.csv("Potentilla_final2.csv") # read in Potentilla data
pot<-pot[c(-119,-223),] #removing one row with NA in treatment column
pot<-pot[!is.na(pot$relative.position),] #removing NA values in relative position
pot<-pot[!is.na(pot$total.seeds),] #removing NA values in total seeds column
pot$deviation<-abs(pot$relative.position) #getting deviation from the peak
pot$early.late<-factor(NA, levels = c("early","late")) #creating early/late variables based on relative position
pot$early.late[pot$relative.position<0]<-"early"
pot$early.late[pot$relative.position>0]<-"late"
pot<-pot[!is.na(pot$early.late),] #still not sure
```

Because many of the Potentilla individuals were still in bloom when we finished our field season, we had to calculate a midpoint and relative position based on those individuals that had senesced. A key factor that determines duration of blooming is the number of flowers on the individual. The data imported includes those relative position estimates for the individuals that didn't senesce before we finished our field season. For more information on how those numbers were calculated, see Data_Cleaning.Rmd.

## Flower Count Data

The community flower count data is essential to the number of conspecifics effect. Each of the species has to be analyzed separately.

```{r importing flower counts}
flower.counts=read.csv("flower_counts.csv") #read in flower count data
```

### Mertensia

We calculated the average number of Mertensia flowers in each site and plot in each week. This number was then merged with the Mertensia individuals to add the number of conspecifics variable.

```{r mert flower count manipulation}
mert.flower.counts<-flower.counts[(flower.counts$plant=="Mertensia fusiformis"),] #limit flower counts to Mertensia data
mert.counts.by.site<-aggregate(x=mert.flower.counts$total_flowers,by=list(mert.flower.counts$date,mert.flower.counts$site,mert.flower.counts$plot),FUN="mean") #calculate mean flower counts by week and site
colnames(mert.counts.by.site)<-c("date","site","plot.treat","number.conspecifics")
```

```{r merging to get mert conspecifics, results="hide"}
mert.counts.by.site$site<-as.character(mert.counts.by.site$site) #changing class to adjust names
mert.counts.by.site$plot.treat<-as.character(mert.counts.by.site$plot.treat)

mert.counts.by.site$site[mert.counts.by.site$site=="Avery Picnic"]<-"AveryPicnic" #fixing names
mert.counts.by.site$site[mert.counts.by.site$site=="Stupid Falls"]<-"StupidFalls"
mert.counts.by.site$site[mert.counts.by.site$site=="Wash 3C"]<-"WG3C"
mert.counts.by.site$plot.treat[!(mert.counts.by.site$plot.treat=="Kaysee")]
mert.counts.by.site$plot.treat[mert.counts.by.site$plot.treat=="Control"]<-"control"
mert.counts.by.site$plot.treat[mert.counts.by.site$plot.treat=="Manipulated"]<-"manip"

mert$week.estimate<-strftime(mert$midpoint, format = "%V") #calculating week numbers in preparation for the merge
mert.counts.by.site$week.estimate<-strftime(mert.counts.by.site$date, format = "%V")

mert<-merge(mert,mert.counts.by.site, by.x = c("site","plot.treat","week.estimate"), by.y = c("site","plot.treat","week.estimate")) #merging by site, plot treatment, and week estimate
```

### Delphinium

The same was repeated for Delphinium and Potentilla.

```{r delph flower count manipulation}
delph.flower.counts<-flower.counts[(flower.counts$plant=="Delphinium nuttallianum"),] #limit flower counts to Delphinium data
delph.counts.by.site<-aggregate(x=delph.flower.counts$total_flowers,by=list(delph.flower.counts$date,delph.flower.counts$site,delph.flower.counts$plot),FUN="mean") #calculate mean flower counts by week and site
colnames(delph.counts.by.site)<-c("date","site","plot.treat","number.conspecifics")
```

```{r merging to get delph conspecifics, results="hide"}
delph.counts.by.site$site<-as.character(delph.counts.by.site$site) #changing class to adjust names
delph.counts.by.site$plot.treat<-as.character(delph.counts.by.site$plot.treat)

delph.counts.by.site$site[delph.counts.by.site$site=="Rustlers Gulch"]<-"RustlersGulch" #fixing names
delph.counts.by.site$site[delph.counts.by.site$site=="Wash 3C"]<-"WG3C"
#delph.counts.by.site$plot.treat[!(delph.counts.by.site$plot.treat=="Kaysee")]
delph.counts.by.site$plot.treat[delph.counts.by.site$plot.treat=="Control"]<-"control"
delph.counts.by.site$plot.treat[delph.counts.by.site$plot.treat=="Manipulated"]<-"manip"

delph$week.estimate<-strftime(delph$midpoint, format = "%V") #calculating week numbers in preparation for the merge
delph.counts.by.site$week.estimate<-strftime(delph.counts.by.site$date, format = "%V")

delph<-merge(delph,delph.counts.by.site, by.x = c("site","plot.treat","week.estimate"), by.y = c("site","plot.treat","week.estimate")) #merging by site, plot treatment, and week estimate
```

### Potentilla

```{r pot flower count manipulation}
pot.flower.counts<-flower.counts[(flower.counts$plant=="Potentilla pulcherrima"),] #limit flower counts to Potentilla data
pot.counts.by.site<-aggregate(x=pot.flower.counts$total_flowers,by=list(pot.flower.counts$date,pot.flower.counts$site,pot.flower.counts$plot),FUN="mean") #calculate mean flower counts by week and site
colnames(pot.counts.by.site)<-c("date","site","plot.treat","number.conspecifics")
```

```{r merging to get pot conspecifics, results="hide"}
pot.counts.by.site$site<-as.character(pot.counts.by.site$site) #changing class to adjust names
pot.counts.by.site$plot.treat<-as.character(pot.counts.by.site$plot.treat)

pot.counts.by.site$site[pot.counts.by.site$site=="Rustlers Gulch"]<-"RustlersGulch" #fixing names
pot.counts.by.site$site[pot.counts.by.site$site=="Wash 3C"]<-"WG3C"
pot.counts.by.site$site[pot.counts.by.site$site=="Bellview Bench"]<-"BellviewBench"
pot.counts.by.site$site[pot.counts.by.site$site=="Avery Picnic"]<-"AveryPicnic"
pot.counts.by.site$site[pot.counts.by.site$site=="Stupid Falls"]<-"StupidFalls"
#pot.counts.by.site$plot.treat[!(pot.counts.by.site$plot.treat=="Kaysee")]
pot.counts.by.site$plot.treat[pot.counts.by.site$plot.treat=="Control"]<-"control"
pot.counts.by.site$plot.treat[pot.counts.by.site$plot.treat=="Manipulated"]<-"manip"

pot$week.estimate<-strftime(pot$midpoint, format = "%V") #calculating week numbers in preparation for the merge
pot.counts.by.site$week.estimate<-strftime(pot.counts.by.site$date, format = "%V")

pot<-merge(pot,pot.counts.by.site, by.x = c("site","plot.treat","week.estimate"), by.y = c("site","plot.treat","week.estimate")) #merging by site, plot treatment, and week estimate
```

# Mixed Effects Models: Effect of Soil Moisture Variables on Total Seeds

Soil moisture is a covariate that may impact seed production. In the field, we measured soil moisture in designated areas of the plot once per week, for 9 weeks. To understand which variables representing change in soil moisture are most influential for seed production, we will run a generalized linear mixed model with all of the soil moisture variables. Site, plot treatment, and species are random effects, while the soil moisture variables (mean moisture, rate of change, effective minimum or value at week 7, final moisture reading, and range) are fixed effects. Once we have this model, we will run the dredge function to find the most appropriate combination of variables for our larger model.

We are including all of the individuals of the three species and using species as a random effect.

```{r combining all of the seed data}
condensed.mert<-mert[,c(-1,-19:-22,-29)] #removing unnecessary columns
condensed.delph<-delph[,c(-1,-19:-27,-29,-35)]
condensed.pot<-pot[,c(-1,-19:-27,-29,-32:-36)]
all.seeds<-rbind(condensed.mert,condensed.delph,condensed.pot) #combining all of the data sets
```

```{r checking distribution for all seed data}
all.seed.nbinom<-fitdist(all.seeds$total.seeds, "nbinom") #fitting Mertensia data to negative binomial distribution using fitdistplus
plot(all.seed.nbinom) #plotting to see the fit
```

The seeds fit a negative binomial distribution, so we will use the glmmADMB package.

```{r soil model with glmmadmb}
soil.mod<-glmmadmb(total.seeds ~ mean + rate + effect.min + end + range + (1|site/plot.treat) + (1|species), family = "nbinom2", data = all.seeds) #model for soil moisture variables with all seeds
summary(soil.mod)
```

```{r model selection with dredge}
#dredge_result<-dredge(soil.mod) #using dredge funciton for model selection
#subset(dredge_result, delta<4)
```

The null model was the best for these data. None of the combinations of soil moisture variables were selected for predicting the data. As a result, we won't include soil moisture as a fixed effect in our final model.

# Mixed Effects Models with Count Data

Generalized linear mixed effects models were appropriate for this analysis because the data contain sources of non-independence. Individual plants were located in the same site as other individuals and were likely genetically similar. Therefore, we considered site a random effect. 

The response variable is total seeds, which is discrete and non-zero. The interaction between deviation and the early/late factor was a fixed effect, as well as pollen limitation treatment and the interaction between plot treatment and conspecific density. We would have included soil moisture as a covariate and fixed effect in our model, but soil moisture was not important for seed production. Each species is analyzed separately. 

## Mertensia

We started by checking the distribution of the total seed counts.

```{r checking Mertensia distribution}
mert.nbinom<-fitdist(mert$total.seeds, "nbinom") #fitting Mertensia data to negative binomial distribution using fitdistplus
plot(mert.nbinom) #plotting to see the fit
```

The Mertensia seed data fits a negative binomial distribution. The glmmADMB package is the best for modeling data with a negative binomial fit.

```{r Mertensia glmmadmb with relative position}
mert.glmmadmb<-glmmadmb(total.seeds ~ deviation * early.late + plot.treat * number.conspecifics + treat + (1|site), family = "nbinom2", data = mert) #Mertensia model for negative binomial data with glmmadmb package
summary(mert.glmmadmb) #summary of model output
```

The total number of developed seeds were unaffected by relative flowering time, number of conspecifics in bloom, or pollen limitation treatment. 

Below is the plot of seed set vs. relative position of blooming in the community for Mertensia individuals. Plot treatment is indicated by individual color, and treatment received (open or pollen-supplemented) is indicated by individual shape.

```{r Mertensia plot}
ggplot(mert, aes(x=mert$relative.position, y=mert$total.seeds, group=mert$plot.treat)) +
  labs(y="Total Developed Seeds",x="Days Relative to Population Peak Bloom", title="Effect of Mertensia Blooming Time on Total Developed Seeds") +
  geom_point(aes(color=plot.treat),size=3, alpha = 0.8) +
  scale_color_brewer(palette="Dark2") + labs(color="Plot Treatment") +
  scale_color_manual(labels= c("control","accelerated"), values = c("control"="darkgreen","manip"="darkorange")) +
  geom_smooth()
```

While the line of best fit is somewhat unimodal, there is not a strong relationship between relative position of blooming time and total number of developed seeds.


Now we'll try with the interaction between deviation and early/late instead of relative position in order to fit a linear model.

```{r Mertensia plot substituting relative position}
ggplot(mert, aes(x=mert$deviation, y=mert$total.seeds, group= mert$early.late)) +
  labs(y="Total Developed Seeds",x="Days Relative to Population Peak Bloom", title="Effect of Mertensia Deviation from Peak on Total Developed Seeds") + theme_classic() +
  geom_point(size=3, alpha = 0.8, aes(color=early.late)) +
  geom_smooth(method="glm",aes(color=early.late)) +
  labs(color="Early or Late")
```


Now we will look at conspecific density and its effects on total developed seeds.

```{r Mertensia plot with conspecific density}
ggplot(mert, aes(x=mert$number.conspecifics, y=mert$total.seeds, group= mert$plot.treat)) +
  labs(y="Total Developed Seeds",x="Conspecific Density", title="Effect of Mertensia Conspecific Density on Total Developed Seeds") +
  geom_point(size=3, alpha = 0.8, aes(color=plot.treat)) +
  labs(color="Plot Treatment") +
  geom_smooth(method="glm", aes(color=plot.treat)) +
  theme_classic()
```

High conspecific density may have a negative effect on total number of developed seeds, but the relationship is fairly weak. There is no difference between control and manip.

## Delphinium

```{r checking Delphinium distribution}
delph.nbinom<-fitdist(delph$total.seeds, "nbinom") #fitting negative binomial distribution using fitdistplus package
plot(delph.nbinom) #plotting distribution fit
```

The Delphinium data fits a negative binomial distribution. We will use the glmmADMB package again.

```{r Delphinium glmmADMB}
delph.glmmadmb<-glmmadmb(total.seeds ~ deviation * early.late + plot.treat * number.conspecifics + treat + (1|site), family = "nbinom2", data = delph) #Delphinium model for negative binomial data with glmmadmb package
summary(delph.glmmadmb) #summary of model output
```

The relative blooming time, number of conspecifics in bloom, and pollen limitation treatment did not affect the total number of developed seeds.

Below is the same plot for the Delphinium individuals.

```{r Delphinium plot}
ggplot(delph, aes(x=delph$relative.position, y=delph$total.seeds, group=plot.treat)) +
  labs(title="Effect of Delphinium Blooming Time on Total Developed Seeds", y="Total Developed Seeds",x="Days Relative to Population Peak Bloom") +
  geom_point(aes(color=plot.treat),size=3, alpha = 0.8) +
  scale_color_brewer(palette="Dark2") + labs(color="Plot Treatment") +
  scale_color_manual(labels= c("control","accelerated"), values = c("control"="darkgreen","manip"="darkorange")) +
  geom_smooth()
```

Delphinium developed seeds seem to peak in the manip and late in the control. There is also a slight increase near the population peak.

```{r delphinium plot substituting relative position}
ggplot(delph, aes(x=delph$deviation, y=delph$total.seeds, group= delph$early.late)) +
  labs(y="Total Developed Seeds",x="Days Relative to Population Peak Bloom", title="Effect of Delphinium Deviation from Peak on Total Developed Seeds") +
  theme_classic() +
  geom_point(size=3, alpha = 0.8, aes(color=early.late)) +
  geom_smooth(method="glm",aes(color=early.late)) +
  labs(color="Early or Late")
```



```{r Delphinium plot with conspecific density}
ggplot(delph, aes(x=delph$number.conspecifics, y=delph$total.seeds, group= delph$plot.treat)) +
  labs(y="Total Developed Seeds",x="Conspecific Density", title="Effect of Delphinium Conspecific Density on Total Developed Seeds") +
  geom_point(size=3, alpha = 0.8, aes(color=plot.treat)) +
  labs(color="Plot Treatment") +
  geom_smooth(method="glm", aes(color=plot.treat)) +
  theme_classic()
```

## Potentilla

```{r checking Potentilla distribution}
pot.nbinom<-fitdist(pot$total.seeds, "nbinom") #fitting negative binomial distribution using fitdistplus package
plot(pot.nbinom) #plotting distribution fit
```

```{r Potentilla glmm}
pot.glmmadmb<-glmmadmb(total.seeds ~ deviation * early.late + plot.treat * number.conspecifics + plot.treat + treat + (1|site), family = "nbinom2", data = pot) #Potentilla model for negative binomial data with glmmadmb package
summary(pot.glmmadmb) #summary of model output
```

For Potentilla, as deviation from the popultion peak increases, developed seeds may increase (p=0.079). Additionally, the number of developed seeds was significantly greater in the manipulated plot (p=0.016), and as Potentilla individuals bloom later in the season compared to the population peak, the seed set may decrease (p=0.080). In terms of the density of conspecifics, as the number of conspecifics increased, the number of developed seeds increased (p=0.019). However, in the manipulated plot, as the number of conspecifics increased, the seed set decreased (p=0.049). (why???)

Below is the plot for Potentilla individuals.

```{r Potentilla plot}
ggplot(pot, aes(x=pot$relative.position, y=pot$total.seeds, group=plot.treat)) +
  labs(title="Effect of Potentilla Blooming Time on Total Developed Seeds", y="Total Developed Seeds",x="Days Relative to Population Peak Bloom") +
  geom_point(aes(color=plot.treat),size=3, alpha = 0.8) +
  scale_color_brewer(palette="Dark2") + labs(color="Plot Treatment") +
  scale_color_manual(labels= c("control","accelerated"), values = c("control"="darkgreen","manip"="darkorange")) +
  geom_smooth()
```

```{r potentilla plot substituting relative position}
ggplot(pot, aes(x=pot$deviation, y=pot$total.seeds, group= pot$early.late)) +
  labs(y="Total Developed Seeds",x="Days Relative to Population Peak Bloom",title="Effect of Potentilla Deviation from Peak on Total Developed Seeds") +
  theme_classic() +
  geom_point(size=3, alpha = 0.8, aes(color=early.late)) +
  geom_smooth(method="glm",aes(color=early.late)) +
  labs(color="Early or Late")
```

```{r Potentilla plot with conspecific density}
ggplot(pot, aes(x=pot$number.conspecifics, y=pot$total.seeds, group= pot$plot.treat)) +
  labs(y="Total Developed Seeds",x="Conspecific Density", title="Effect of Potentilla Conspecific Density on Total Developed Seeds") +
  geom_point(size=3, alpha = 0.8, aes(color=plot.treat)) +
  labs(color="Plot Treatment") +
  geom_smooth(method="glm", aes(color=plot.treat)) +
  theme_classic()
```

# Mixed Effects Model with Proportion Data

Only the Mertensia and Delphinium data included proportion of developed seeds to total seeds. 

## Mertensia

```{r Mertensia undeveloped seeds}
mert$undev.seeds<-(mert$total.seeds-mert$dev.seed) #creating an undeveloped seed column for cbind
```

```{r Mertensia proportion model}
Mert.glmer<-glmer(cbind(dev.seed,undev.seeds) ~ deviation * early.late + plot.treat * number.conspecifics + treat + (1|site), family = binomial, data = mert) #Mertensia model with proportion of developed seeds using lme4 package
summary(Mert.glmer)
```

For Mertensia individuals, as deviation from the population peak increases, the proportion of developed seeds may decrease (p=0.0769). Additionally, as the number of conspecifics increases, the proportion of developed seeds may decrease (p=0.0572). In the manipulated plot, as conspecific density increases, seed set may decrease (p=0.0748).

```{r Mertensia proportion plot}
mert<-mert[!is.na(mert$prop.dev.seeds),] #removing NA values from proportion column

ggplot(mert, aes(x=mert$relative.position, y=mert$prop.dev.seeds, group=plot.treat)) +
  labs(y="Proportion of Developed Seeds",x="Days Relative to Population Peak Bloom",title="Effect of Mertensia Blooming Time on Proportion of Developed Seeds") +
  geom_point(aes(color=plot.treat),size=3, alpha = 0.8) +
  scale_color_brewer(palette="Dark2") + labs(color="Plot Treatment") +
  scale_color_manual(labels= c("control","accelerated"), values = c("control"="darkgreen","manip"="darkorange")) +
  geom_smooth()
```

```{r Mertensia deviation proportion plot}
ggplot(mert, aes(x=mert$deviation, y=mert$prop.dev.seeds, group= mert$early.late)) +
  labs(y="Proportion of Developed Seeds",x="Days Relative to Population Peak Bloom",title="Effect of Mertensia Deviation from Peak on Proportion of Developed Seeds") +
  theme_classic() +
  geom_point(size=3, alpha = 0.8, aes(color=early.late)) +
  geom_smooth(method="glm",aes(color=early.late)) +
  labs(color="Early or Late")
```

```{r mertensia plot conspecifics and proportions}
ggplot(mert, aes(x=mert$number.conspecifics, y=mert$prop.dev.seeds, group= mert$plot.treat)) +
  labs(y="Proportion of Developed Seeds",x="Conspecific Density",title="Effect of Mertensia Conspecific Density on Proportion of Developed Seeds") +
  geom_point(size=3, alpha = 0.8, aes(color=plot.treat)) +
  labs(color="Plot Treatment") +
  geom_smooth(method="glm", aes(color=plot.treat)) +
  theme_classic()
```

## Delphinium

```{r Delphinium proportion model}
delph$dev.seed.total<-delph$dev.seed+delph$dev.seed1 #creating developed seeds column
delph$undev.seed.total<-delph$undev.seed+delph$undev.seed1 #creating undeveloped seeds column

Delph.glmer<-glmer(cbind(dev.seed.total,undev.seed.total) ~ deviation * early.late + plot.treat * number.conspecifics + treat + (1|site), family = binomial, data = delph) #modeling Delphinium proportion of developed seeds with lme4 package
summary(Delph.glmer)
```

For Delphinium individuals, late individuals had significantly lower seed set (p=0.0156). As individuals deviated from the population peak more and bloomed much later in the season, the proportion of developed seeds increased significantly (p=5.89e-09). (why??) Plot treatment had an effect on proportion of developed seeds, in that the manipulated plot had a significantly higher proportion of developed seeds (p=0.0227). In terms of the conspecific density, as conspecific density increased, the proportion of developed seeds increased (p=0.0291). However, in the manipulated plot, as the number of conspecifics increased, the proportion of developed seeds significantly decreased (p=1.48e-06). (why??) Additionally, the open-hand pollen limitation treatment had a slightly positive effect on the proportion (p=0.0593).

```{r Delphinium proportion plot}
delph<-delph[!is.na(delph$prop.dev.seeds),] #removing NA values in proportion column
ggplot(delph, aes(x=delph$relative.position, y=delph$prop.dev.seeds, group=plot.treat)) +
  labs(title="Effect of Delphinium Blooming Time on Proportion of Developed Seeds", y="Proportion of Developed Seeds",x="Days Relative to Population Peak Bloom") +
  geom_point(aes(color=plot.treat),size=3, alpha = 0.8) +
  scale_color_brewer(palette="Dark2") + labs(color="Plot Treatment") +
  scale_color_manual(labels= c("control","accelerated"), values = c("control"="darkgreen","manip"="darkorange")) + 
  geom_smooth()
```

```{r Delphinium deviation proportion plot}
ggplot(delph, aes(x=delph$deviation, y=delph$prop.dev.seeds, group= delph$early.late)) +
  labs(y="Proportion of Developed Seeds",x="Days Relative to Population Peak Bloom",title="Effect of Delphinium Deviation from Peak on Proportion of Developed Seeds") +
  theme_classic() +
  geom_point(size=3, alpha = 0.8, aes(color=early.late)) +
  geom_smooth(method="glm",aes(color=early.late)) +
  labs(color="Early or Late")
```

```{r Delphinium plot conspecifics and proportions}
ggplot(delph, aes(x=delph$number.conspecifics, y=delph$prop.dev.seeds, group= delph$plot.treat)) +
  labs(y="Proportion of Developed Seeds",x="Conspecific Density",title="Effect of Delphinium Conspecific Density on Proportion of Developed Seeds") +
  geom_point(size=3, alpha = 0.8, aes(color=plot.treat)) +
  labs(color="Plot Treatment") +
  geom_smooth(method="glm", aes(color=plot.treat)) +
  theme_classic() + xlim(0,110)
```

# Session Info

```{r Session Info}
sessionInfo()
```

